import{ac as R,a as d,c as E,r as u,ad as t}from"./index-CVL7vCnP.js";const g=()=>{const o=R(),{auth:c,setAuth:a}=d(),i=E(),s=u.useRef(null);return u.useEffect(()=>{const f=t.interceptors.request.use(e=>(e.headers.Authorization||(e.headers.Authorization=`Bearer ${c?.accessToken}`),e),e=>Promise.reject(e)),h=t.interceptors.response.use(e=>e,async e=>{const n=e?.config;return!e.response&&(e.code==="ERR_NETWORK"||e.message?.includes("Network Error")),e?.response?.status===401&&!n?.sent?(n.sent=!0,s.current&&await s.current,s.current||(s.current=new Promise(async(p,l)=>{try{const r=await o();n.headers.Authorization=`Bearer ${r}`,p()}catch(r){!r.response&&(r.code==="ERR_NETWORK"||r.message?.includes("Network Error"))?console.error("Refresh token failed due to network error:",r):(console.error("Refresh token failed, logging out:",r),a({}),i("/signin")),l(r)}finally{s.current=null}})),await s.current,t(n)):Promise.reject(e)});return()=>{t.interceptors.request.eject(f),t.interceptors.response.eject(h)}},[c,o,a,i]),t};export{g as u};
